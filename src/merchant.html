<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>화장품 결제 페이지</title>
    <link rel="stylesheet" href="merchant.css" />
  </head>
  <body>
    <div class="container">
      <div class="checkout-grid">
        <!-- Left Column - Product Details -->
        <div class="product-section">
          <!-- Product Image -->
          <div class="product-image-container"><!-- Product Image -->
            <img src="./products.png" alt="프리미엄 비타민 C 세럼 에센스" class="product-image" />
          </div>          
          <!-- Product Info -->
          <div class="product-info">
            <div class="product-header">
              <p class="brand-name">뷰티브랜드</p>
              <h1 class="product-name">프리미엄 비타민 C 세럼 에센스 30ml</h1>
            </div>

            <div class="rating-section">
              <div class="rating">
                <span class="star">★</span>
                <span class="rating-value">4.8</span>
              </div>
              <span class="review-count">(2,847개 리뷰)</span>
            </div>

            <div class="price-section">
              <span class="original-price">120,000원</span>
              <span class="current-price">89,000원</span>
              <span class="discount-badge">26% 할인</span>
            </div>

            <p class="product-description">
              순수 비타민 C 20% 함유로 피부 톤 개선과 안티에이징에 효과적인
              프리미엄 세럼입니다. 하이알루론산과 나이아신아마이드가 추가로
              함유되어 보습과 진정 효과까지 제공합니다.
            </p>

            <!-- Quantity Selection -->
            <div class="quantity-section">
              <label class="quantity-label">수량</label>
              <div class="quantity-controls">
                <button class="quantity-btn minus" onclick="updateQuantity(-1)">
                  -
                </button>
                <span class="quantity-display" id="quantity">1</span>
                <button class="quantity-btn plus" onclick="updateQuantity(1)">
                  +
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column - Checkout Forms -->
        <div class="checkout-section">
          <!-- Order Summary -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">주문 요약</h3>
            </div>
            <div class="card-content">
              <div class="order-item">
                <img src="./products.png" alt="프리미엄 비타민 C 세럼 에센스" class="item-image-placeholder" />
                <div class="item-details">
                  <p class="item-brand">뷰티브랜드</p>
                  <h4 class="item-name">프리미엄 비타민 C 세럼 에센스 30ml</h4>
                  <p class="item-quantity-price">
                    <span id="item-quantity">1</span>개 × 89,000원
                  </p>
                </div>
              </div>

              <div class="price-breakdown">
                <div class="price-row">
                  <span>상품금액</span>
                  <span id="subtotal">89,000원</span>
                </div>
                <div class="price-row">
                  <span>배송비</span>
                  <span>3,000원</span>
                </div>
                <div class="separator"></div>
                <div class="price-row total">
                  <span>총 결제금액</span>
                  <span class="total-price" id="total">92,000원</span>
                </div>
              </div>
            </div>
          </div>
          <!-- Payment Method -->
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">결제 방법</h3>
            </div>
            <div class="card-content">
              <div class="payment-options">
                <div class="payment-option">
                  <input
                    type="radio"
                    id="card"
                    name="payment"
                    value="card"
                    checked
                  />
                  <label for="card" class="payment-label">
                    <span class="payment-icon">💳</span>
                    신용카드
                  </label>
                </div>
                <div class="payment-option">
                  <input type="radio" id="ohgoodpay" name="payment" value="ohgoodpay" />
                  <label for="ohgoodpay" class="payment-label">
                    <span class="payment-icon">💳</span>
                    오굿페이
                  </label>
                </div>
                <div class="payment-option">
                  <input type="radio" id="bank" name="payment" value="bank" />
                  <label for="bank" class="payment-label">
                    <span class="payment-icon">💰</span>
                    무통장입금
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Payment Button -->
          <button class="payment-btn" onclick="processPayment()">
            <span id="payment-amount">92,000원</span> 결제하기
          </button>
        </div>
      </div>
    </div>
  <div id="ohgoodpay-widget" class="ogp-modal"></div>
<script
  src="https://ohgoodpay.s3.ap-northeast-2.amazonaws.com/sdk/pay.min.js"
  data-api-base-url="http://localhost:8080"
></script>
<script>
async function processPayment() {
  const selected = document.querySelector('input[name="payment"]:checked').value;
  const widget = document.getElementById("ohgoodpay-widget");

  if (selected === "ohgoodpay") {
    widget.style.display = "flex"; // 배경 포함 모달 보이기
    const orderId = crypto.randomUUID();
    const pay = window.OhGoodPay.init();
    pay.mount("#ohgoodpay-widget");

    // 닫기 버튼을 모달 안에서 찾아서 이벤트 연결
    setTimeout(() => {
      const closeBtn = widget.querySelector("#ogp-close");
      if (closeBtn) {
        closeBtn.addEventListener("click", () => {
          widget.style.display = "none"; // 모달 통째로 닫기
        });
      }
    }, 200); // mount 직후에 닫기 버튼이 생기므로 약간의 지연 필요

    try {
      const result = await pay.start({
        orderId,
        totalPrice: 92000,
        requestName: "프리미엄 비타민 C 세럼 결제"
      });

      if (result) {
        //alert("결제 성공!");
        window.location.href = "success.html";
      } else {
        alert("결제 실패");
      }

      widget.style.display = "none"; // 완료 후 모달 닫기
    } catch (e) {
      alert(e.message || "결제 중 오류 발생");
      widget.style.display = "none"; // 오류 시도 닫기
    }
  }
}
</script>

  </body>

</html>
